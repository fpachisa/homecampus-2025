import Problems.Primary5.WholeNumbers.WriteInFigures
import Problems.Primary5.WholeNumbers.WriteInWords
import Problems.Primary5.WholeNumbers.ApproximationEstimation
import Problems.Primary5.WholeNumbers.ComparingAndOrdering
import Problems.Primary5.WholeNumbers.FindPattern
import Problems.Primary5.WholeNumbers.MultiplyDivide
import Problems.Primary5.WholeNumbers.OrderOfOperation
import Problems.Primary5.WholeNumbers.PlaceValue
import Problems.Primary5.WholeNumbers.WordProblems
import Problems.Primary5.Fractions.AddSubMixedFractions
import Problems.Primary5.Fractions.AddSubProperFractions
import Problems.Primary5.Fractions.DivideProperFractions
import Problems.Primary5.Fractions.MultMixedFractions
import Problems.Primary5.Fractions.MultProperImproperFractions
import Problems.Primary5.Fractions.WordProblems
import Problems.Primary5.Decimals.MultiplyDivide
import Problems.Primary5.Decimals.Rounding
import Problems.Primary5.Decimals.WordProblems
import Problems.Primary5.Percentage.ExpressAsPercent
import Problems.Primary5.Percentage.ExpressAsDecimal
import Problems.Primary5.Percentage.ExpressAsFraction
import Problems.Primary5.Percentage.WordProblems
import Problems.Primary5.Ratio.SimplestForm
import Problems.Primary5.Ratio.MissingNumber
import Problems.Primary5.Ratio.WordProblems
import Problems.Primary5.Measurement.UnitConversion
import Problems.Primary5.Measurement.AreaOfTriangle
import Problems.Primary5.Measurement.Volume
import Problems.Primary5.Measurement.WordProblems
import Problems.Primary5.Geometry.Angles
import Problems.Primary5.Geometry.Triangles
import Problems.Primary5.Geometry.FourSidedFigures
import Problems.Primary5.DataAnalysis.FindAverage
import Problems.Primary5.DataAnalysis.FindTotal
import Problems.Primary5.DataAnalysis.WordProblems
import Problems.Primary6.Algebra.SimplifyingAlgebra
import Problems.Primary6.Algebra.EvaluationAlgebra
import Problems.Primary6.Fractions.DivideWholeNumber
import Problems.Primary6.Fractions.DivideProperFraction
import Problems.Primary6.Percentage.WholePart
import Problems.Primary6.Percentage.PercentIncDec
import Problems.Primary6.Speed.DistanceTimeSpeed
import Problems.Primary6.Measurement.CircleCircumference
import Problems.Primary6.Measurement.CircleArea
import Problems.Primary6.Measurement.CircleRadiusDiameter
import Problems.Primary6.Measurement.SemiCircleArea
import Problems.Primary6.Measurement.SemiCirclePerimeter
import Problems.Primary6.Measurement.CompositeFigures
import Problems.Primary6.Measurement.VolumeOfCubeCuboid
import Problems.Primary4.WholeNumbers.WriteInWords
import Problems.Primary4.WholeNumbers.WriteInFigures
import Problems.Primary4.WholeNumbers.RoundingOff
import Problems.Primary4.WholeNumbers.PlaceValue
import Problems.Primary4.WholeNumbers.FactorMultiple
import Problems.Primary4.WholeNumbers.ComparingAndOrdering
import Problems.Primary4.WholeNumbers.MultiplicationDivision
import Problems.Primary4.Fractions.MixedNumbersImproperFractions
import Problems.Primary4.Fractions.SimplifyingFractions
import Problems.Primary4.Fractions.AddLikeRelatedFractions
import Problems.Primary4.Fractions.SubtractLikeRelatedFractions
import Problems.Primary4.Fractions.MultiplyProperImproperFractions
import Problems.Primary4.Decimals.DecimalsTenths
import Problems.Primary4.Decimals.DecimalsHundredths
import Problems.Primary4.Decimals.DecimalsThousandths
import Problems.Primary4.Decimals.DecimalsComparingOrdering
import Problems.Primary4.Decimals.DecimalsRoundingOff
import Problems.Primary4.Decimals.DecimalsFractions
import Problems.Primary4.Decimals.DecimalsAddSub
import Problems.Primary4.Decimals.DecimalsMultiplyDivide
import Problems.Primary4.Measurement.MTTime24Hrs
import Problems.Primary4.Measurement.MTTimeDuration
import Problems.Primary4.Measurement.MTPerimeter
import Problems.Primary4.Measurement.MTArea
import Problems.Primary4.Measurement.MTCompositeFigures
import Problems.Primary6.Ratio.P6RTWordProblems
import Problems.Primary6.DataAnalysis.P6DAWordProblems
import Problems.Primary6.Algebra.P6AGWordProblems
import Problems.Primary6.Fractions.P6FRWordProblems
import Problems.Primary6.Speed.P6SPWordProblems
import Problems.Primary6.Percentage.P6PRWordProblems
import Problems.Primary4.DataAnalysis.P4DATablesBarGraphs
import Problems.Primary4.DataAnalysis.P4DALineGraphs
import Problems.Primary4.WholeNumbers.P4WNWordProblems
import Problems.Primary4.Decimals.P4DCWordProblems
import Problems.Primary4.Fractions.P4FRWordProblems

import Problems.Primary3.WholeNumbers.P3WNPlaceValue
import Problems.Primary3.WholeNumbers.P3WNFiguresToWords
import Problems.Primary3.WholeNumbers.P3WNWordsToFigures
import Problems.Primary3.WholeNumbers.P3WNComparingOrdering
import Problems.Primary3.WholeNumbers.P3WNNumberPatterns
import Problems.Primary3.WholeNumbers.P3WNAddition
import Problems.Primary3.WholeNumbers.P3WNSubtraction
import Problems.Primary3.WholeNumbers.P3WNMultiplication
import Problems.Primary3.WholeNumbers.P3WNDivision
import Problems.Primary3.WholeNumbers.P3WNWordProblems
import Problems.Primary3.Money.P3MOAddition
import Problems.Primary3.Money.P3MOSubtraction
import Problems.Primary3.Money.P3MOWordProblems
import Problems.Primary3.LengthMassVolume.P3LMMetreCentiMetre
import Problems.Primary3.LengthMassVolume.P3LMKiloMetre
import Problems.Primary3.LengthMassVolume.P3LMKiloGram
import Problems.Primary3.LengthMassVolume.P3LMLitresMilli
import Problems.Primary3.LengthMassVolume.P3LMWordProblems
import Problems.Primary3.LengthMassVolume.P3LMWordProblems_2Steps
import Problems.Primary3.Time.P3TITellingTime
import Problems.Primary3.Time.P3TIConversionTime
import Problems.Primary3.Time.P3TIDuration
import Problems.Primary3.Time.P3TIAddition
import Problems.Primary3.Time.P3TISubtraction
import Problems.Primary3.Time.P3TIWordProblems
import Problems.Primary3.Angles.P3ANIdentifying
import Problems.Primary3.Angles.P3ANRightAngle
import Problems.Primary3.BarGraphs.P3BGBarGraphs
import Problems.Primary3.AreaPerimeter.P3APSquareUnits
import Problems.Primary3.AreaPerimeter.P3APSquareCmM
import Problems.Primary3.AreaPerimeter.P3APPerimeter
import Problems.Primary3.AreaPerimeter.P3APArea
import Problems.Primary3.AreaPerimeter.P3APWordProblems
import Problems.Primary3.Fractions.P3FRWhatIsFractions
import Problems.Primary3.Fractions.P3FREquivalentFractions
import Problems.Primary3.Fractions.P3FRSimplifyingFractions
import Problems.Primary3.Fractions.P3FRComparingOrdering
import Problems.Primary3.Fractions.P3FRAddition
import Problems.Primary3.Fractions.P3FRSubtraction
import Problems.Primary3.PerpendicularParallel.P3PPPerpendicularParallel

import Problems.Primary1.WholeNumbers.P1WNAddition

import SubmitProblem
import Config
from tipfy import RequestHandler
from tipfy import Rule
from Config import config
from tipfy import Tipfy
from tipfy.sessions import SessionMiddleware
from tipfyext.jinja2 import Jinja2Mixin
from google.appengine.api import memcache
from Database import SubmitProblemsTable
import datetime

import logging

import HCRank

rules = [Rule('/submit', endpoint='/submit', handler='Submit.Submit')]

class Submit(RequestHandler, Jinja2Mixin):
    middleware = [SessionMiddleware()]
    def post(self):
        student_id = unicode(self.request.form.get('student_id'))
        template_values = memcache.Client().get(student_id+'_template_values')
        logging.info(student_id+": In submit")
        logging.info(template_values)
        '''deleting the template_values from memcache as its not required now here and will help to detect if two people using same id'''
        memcache.Client().delete(student_id+"_template_values")
        ProblemQuery = SubmitProblemsTable.ProblemsTable.gql("where student_id = '"+student_id+"' order by submit_date desc")
        ProblemData = ProblemQuery.fetch(1)
        if not template_values:
            try:
            #02-MAY-2013..instead of showing timeout error the template values are populate from the database if the question was generated within 1 hr
                if ProblemData[0].submit_date > (datetime.datetime.now() - datetime.timedelta(hours=1)):
                    template_values = {"explain":{"explain_text":str(ProblemData[0].explain),"explain_template":"Explanation.html"},
                                       "CheckAnswerType":int(ProblemData[0].CheckAnswerType),
                                       "template":str(ProblemData[0].template),
                                       "answer":str(ProblemData[0].answer),
                                       }
                    logging.info(template_values)
                else:
                    logging.info("couldn't get template values from memcache and took more than 1 hour")
                    template_values = None
                    self.ErrorMessage = {'explain_text':"Show error message"}
                    return self.render_response("Explanation.html", **self.ErrorMessage)                    
            except IndexError:
                logging.info("couldn't get template values from memcache and also from the database")
                self.ErrorMessage = {'explain_text':"Show error message"}
                return self.render_response("Explanation.html", **self.ErrorMessage)

        concept = str(self.request.form.get('concept'))

        #Creating the SubmitObject to store in the google datastore
        #answer = template_values["answer"]
        submitted = self.request.form.get('answer')

        #SubmitObject = ProblemQuery.fetch(1)        
        try:
            ProblemData[0].answer_submitted=submitted
            ProblemData[0].time_taken=int(self.request.form.get('time_taken'))
            ProblemData[0].grade=int(self.request.form.get('grade'))
            ProblemData[0].complexity_level=self.request.form.get('complexity_level')
            ProblemData[0].concept = concept
        except IndexError:
            self.ErrorMessage = {'explain_text':"Show error message"}
            return self.render_response("Explanation.html", **self.ErrorMessage)
        
        self.explain_dict = template_values["explain"]        
        template_name = str(self.explain_dict["explain_template"])  
        
        session_problems_attempted = self.session.get('problems_attempted')        
        if not session_problems_attempted:
            self.session['problems_attempted'] = 1
            session_problems_attempted = 1
        else:
            session_problems_attempted = int(session_problems_attempted) + 1
        concept_rank = memcache.Client().get(student_id+'_concept_rank')
        if not concept_rank:
            concept_rank = self.GetConceptRank()
            memcache.Client().add(student_id+'_concept_rank',concept_rank,3600)
        try:
            problems_attempted = concept_rank[concept][0]
            correct_problems = concept_rank[concept][1]
            Concept_HCScore = concept_rank[concept][2]
        except KeyError:
            problems_attempted = 0
            correct_problems = 0
            Concept_HCScore = 0
        problems_attempted = problems_attempted + 1
        SessionHCScore = self.session.get('SessionHCScore')
        if not SessionHCScore:
            self.session['SessionHCScore'] = 0
            SessionHCScore = 0
        self.session['problems_attempted'] = session_problems_attempted
        
        #checking the answer
        if(CheckAnswer(concept,template_values,submitted)):
            session_correct_problems = self.session.get('correct_problems')
            if not session_correct_problems:
                self.session['correct_problems'] = 1
                session_correct_problems = 1
            else:
                session_correct_problems = int(session_correct_problems) + 1
            self.session['correct_problems'] = session_correct_problems
            correct_problems = correct_problems + 1
            ProblemData[0].correct=True
            ProblemData[0].HCScore=int(self.request.form.get('HCScore'))
            SessionHCScore = SessionHCScore + int(self.request.form.get('HCScore'))
            Concept_HCScore = Concept_HCScore + int(self.request.form.get('HCScore'))
            self.session['SessionHCScore'] = SessionHCScore
            # when getting data from session (after inactivity of 10 minutes) the data is in unicode..so converting to str
            explain_text = str(self.explain_dict["explain_text"])
            explain_text = "CorrectANSWERSEPARATOR#"+concept+"ANSWERSEPARATOR"+explain_text
        else:
            ProblemData[0].correct=False
            ProblemData[0].HCScore=0
            explain_text = str(self.explain_dict["explain_text"])
            explain_text = "InCorrectANSWERSEPARATOR#"+concept+"ANSWERSEPARATOR"+explain_text
        
        try:
            Concept_HCRank = HCRank.HCRank[Concept_HCScore]
        #8-Mar-2012: Catching the KeyError for more than 1000 points
        except KeyError:
            Concept_HCRank = "Sage"
        concept_rank[concept] = [problems_attempted,correct_problems,Concept_HCScore,Concept_HCRank]
        memcache.Client().set(student_id+'_concept_rank',concept_rank,3600)
        self.explain = {"explain_text":explain_text}
        #Entering the data  in the Google data store
        
        ProblemData[0].put()
        return self.render_response(template_name, **self.explain)
    
    def GetConceptRank(self):
        Query = SubmitProblemsTable.ProblemsTable.gql("where student_id = '"+unicode(self.auth.user)+"'")
        Data = Query.fetch(10000)
        concept_list = []
        ConceptRank = {}
        for r in Data:
            if r.concept not in concept_list:
                concept_list.append(r.concept)
        
        for i in range(len(concept_list)):
            correct = 0
            total_problems = 0
            HCScore = 0
            #Concept_HCRank = ""
            for r in Data:
                if r.concept == concept_list[i]:
                    total_problems = total_problems + 1
                    if r.correct:
                        correct = correct + 1
                        if not r.HCScore:
                            r.HCScore = 5
                        HCScore = HCScore + r.HCScore
            try:
                Concept_HCRank = HCRank.HCRank[HCScore]
            except KeyError:
                Concept_HCRank = 'Kage'
            ConceptRank[concept_list[i]] = [total_problems,correct,HCScore,Concept_HCRank]
        return ConceptRank

        
def CheckAnswer(concept,template_values,submitted):
    
    # in some concepts word problems can have different answers. To check them we need different versions of CheckAnswer function
    try:
        CheckAnswerType = template_values["CheckAnswerType"]
    except KeyError:
        CheckAnswerType = 1
    
    if CheckAnswerType =="None" or CheckAnswerType is None or CheckAnswerType == "":
        CheckAnswerType = 1
        
    #submitted = self.request.form.get('answer')
    if not submitted:
        submitted = ""
    if (concept=="P5WholeNumbersWriteInFigures"):
        return Problems.Primary5.WholeNumbers.WriteInFigures.WriteInFigures().checkAnswer(template_values["template"],template_values["answer"], submitted)
    elif (concept=="P5WholeNumbersWriteInWords"):
        return Problems.Primary5.WholeNumbers.WriteInWords.WriteInWords().checkAnswer(template_values["template"],template_values["answer"], submitted)
    elif (concept=="P5WholeNumbersPlaceValue"):
        return Problems.Primary5.WholeNumbers.PlaceValue.PlaceValue().checkAnswer(template_values["template"],template_values["answer"], submitted)
    elif (concept=="P5WholeNumbersComparingAndOrdering"):
        return Problems.Primary5.WholeNumbers.ComparingAndOrdering.ComparingAndOrdering().checkAnswer(template_values["template"],template_values["answer"], submitted)
    elif (concept=="P5WholeNumbersFindPattern"):
        return Problems.Primary5.WholeNumbers.FindPattern.FindPattern().checkAnswer(template_values["template"],template_values["answer"], submitted)
    elif (concept=="P5WholeNumbersApproximationEstimation"):
        return Problems.Primary5.WholeNumbers.ApproximationEstimation.ApproximationEstimation().checkAnswer(template_values["template"],template_values["answer"], submitted)
    elif (concept=="P5WholeNumbersMultiplyDivide"):
        return Problems.Primary5.WholeNumbers.MultiplyDivide.MultiplyDivide().checkAnswer(template_values["template"],template_values["answer"], submitted)
    elif (concept=="P5WholeNumbersOrderOfOperation"):
        return Problems.Primary5.WholeNumbers.OrderOfOperation.OrderOfOperation().checkAnswer(template_values["template"],template_values["answer"], submitted)        
    elif (concept=="P5WholeNumbersWordProblems"):
        return Problems.Primary5.WholeNumbers.WordProblems.WordProblems().checkAnswer(template_values["template"],template_values["answer"], submitted, CheckAnswerType)        
    elif (concept=="P5FractionsAddSubProperFractions"):
        return Problems.Primary5.Fractions.AddSubProperFractions.AddSubProperFractions().checkAnswer(template_values["template"],template_values["answer"],submitted)
    elif (concept=="P5FractionsAddSubMixedFractions"):
        return Problems.Primary5.Fractions.AddSubMixedFractions.AddSubMixedFractions().checkAnswer(template_values["template"],template_values["answer"],submitted)
    elif (concept=="P5FractionsMultProperImproperFractions"):
        return Problems.Primary5.Fractions.MultProperImproperFractions.MultProperImproperFractions().checkAnswer(template_values["template"],template_values["answer"],submitted)
    elif (concept=="P5FractionsMultMixedFractions"):
        return Problems.Primary5.Fractions.MultMixedFractions.MultMixedFractions().checkAnswer(template_values["template"],template_values["answer"],submitted)
    elif (concept=="P5FractionsDivideProperFractions"):
        return Problems.Primary5.Fractions.DivideProperFractions.DivideProperFractions().checkAnswer(template_values["template"],template_values["answer"],submitted)
    elif (concept=="P5FractionsWordProblems"):
        return Problems.Primary5.Fractions.WordProblems.WordProblems().checkAnswer(template_values["template"],template_values["answer"],submitted)
    elif (concept=="P5DecimalsMultiplyDivide"):
        return Problems.Primary5.Decimals.MultiplyDivide.MultiplyDivide().checkAnswer(template_values["template"],template_values["answer"],submitted)
    elif (concept=="P5DecimalsRounding"):
        return Problems.Primary5.Decimals.Rounding.Rounding().checkAnswer(template_values["template"],template_values["answer"],submitted)
    elif (concept=="P5DecimalsWordProblems"):
        return Problems.Primary5.Decimals.WordProblems.WordProblems().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P5PercentageExpressAsPercent"):
        return Problems.Primary5.Percentage.ExpressAsPercent.ExpressAsPercent().checkAnswer(template_values["template"],template_values["answer"],submitted)
    elif (concept=="P5PercentageExpressAsDecimal"):
        return Problems.Primary5.Percentage.ExpressAsDecimal.ExpressAsDecimal().checkAnswer(template_values["template"],template_values["answer"],submitted)
    elif (concept=="P5PercentageExpressAsFraction"):
        return Problems.Primary5.Percentage.ExpressAsFraction.ExpressAsFraction().checkAnswer(template_values["template"],template_values["answer"],submitted)
    elif (concept=="P5PercentageWordProblems"):
        return Problems.Primary5.Percentage.WordProblems.WordProblems().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P5RatioSimplestForm"):
        return Problems.Primary5.Ratio.SimplestForm.SimplestForm().checkAnswer(template_values["template"],template_values["answer"],submitted)
    elif (concept=="P5RatioMissingNumber"):
        return Problems.Primary5.Ratio.MissingNumber.MissingNumber().checkAnswer(template_values["template"],template_values["answer"],submitted)
    elif (concept=="P5RatioWordProblems"):
        return Problems.Primary5.Ratio.WordProblems.WordProblems().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P5MeasurementUnitConversion"):
        return Problems.Primary5.Measurement.UnitConversion.UnitConversion().checkAnswer(template_values["template"],template_values["answer"],submitted)
    elif (concept=="P5MeasurementAreaOfTriangle"):
        return Problems.Primary5.Measurement.AreaOfTriangle.AreaOfTriangle().checkAnswer(template_values["template"],template_values["answer"],submitted)                
    elif (concept=="P5MeasurementVolume"):
        return Problems.Primary5.Measurement.Volume.Volume().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)                
    elif (concept=="P5MeasurementWordProblems"):
        return Problems.Primary5.Measurement.WordProblems.WordProblems().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)                
    elif (concept=="P5GeometryAngles"):
        return Problems.Primary5.Geometry.Angles.Angles().checkAnswer(template_values["template"],template_values["answer"],submitted)
    elif (concept=="P5GeometryTriangles"):
        return Problems.Primary5.Geometry.Triangles.Triangles().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P5GeometryFourSided"):
        return Problems.Primary5.Geometry.FourSidedFigures.FourSidedFigures().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P5DataAnalysisAverage"):
        return Problems.Primary5.DataAnalysis.FindAverage.FindAverage().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P5DataAnalysisTotal"):
        return Problems.Primary5.DataAnalysis.FindTotal.FindTotal().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P5DataAnalysisWordProblems"):
        return Problems.Primary5.DataAnalysis.WordProblems.WordProblems().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P6AGSimplifyingExpression"):
        return Problems.Primary6.Algebra.SimplifyingAlgebra.SimplifyingAlgebra().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P6AGEvaluationExpression"):
        return Problems.Primary6.Algebra.EvaluationAlgebra.EvaluationAlgebra().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P6FRDivideWholeNumber"):
        return Problems.Primary6.Fractions.DivideWholeNumber.DivideWholeNumber().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P6FRDivideProperFraction"):
        return Problems.Primary6.Fractions.DivideProperFraction.DivideProperFraction().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P6PRFindWhole"):
        return Problems.Primary6.Percentage.WholePart.WholePart().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P6PRIncDec"):
        return Problems.Primary6.Percentage.PercentIncDec.PercentIncDec().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P6SPDTS"):
        return Problems.Primary6.Speed.DistanceTimeSpeed.DistanceTimeSpeed().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P6MTRadius"):
        return Problems.Primary6.Measurement.CircleRadiusDiameter.CircleRadiusDiameter().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P6MTCircumference"):
        return Problems.Primary6.Measurement.CircleCircumference.CircleCircumference().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P6MTArea"):
        return Problems.Primary6.Measurement.CircleArea.CircleArea().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P6MTSemiPerimeter"):
        return Problems.Primary6.Measurement.SemiCirclePerimeter.SemiCirclePerimeter().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P6MTSemiArea"):
        return Problems.Primary6.Measurement.SemiCircleArea.SemiCircleArea().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P6MTComposite"):
        return Problems.Primary6.Measurement.CompositeFigures.CompositeFigures().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P6MTVolume"):
        return Problems.Primary6.Measurement.VolumeOfCubeCuboid.VolumeOfCubeCuboid().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P6RTWordProblems"):
        return Problems.Primary6.Ratio.P6RTWordProblems.P6RTWordProblems().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P6DAWordProblems"):
        return Problems.Primary6.DataAnalysis.P6DAWordProblems.P6DAWordProblems().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P6AGWordProblems"):
        return Problems.Primary6.Algebra.P6AGWordProblems.P6AGWordProblems().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P6FRWordProblems"):
        return Problems.Primary6.Fractions.P6FRWordProblems.P6FRWordProblems().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P6SPWordProblems"):
        return Problems.Primary6.Speed.P6SPWordProblems.P6SPWordProblems().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P6PRWordProblems"):
        return Problems.Primary6.Percentage.P6PRWordProblems.P6PRWordProblems().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P4WholeNumbersWriteInFigures"):
        return Problems.Primary4.WholeNumbers.WriteInFigures.WriteInFigures().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P4WholeNumbersWriteInWords"):
        return Problems.Primary4.WholeNumbers.WriteInWords.WriteInWords().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P4WholeNumbersPlaceValues"):
        return Problems.Primary4.WholeNumbers.PlaceValue.PlaceValue().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P4WholeNumbersComparingOrdering"):
        return Problems.Primary4.WholeNumbers.ComparingAndOrdering.ComparingAndOrdering().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P4WholeNumbersRoundingOff"):
        return Problems.Primary4.WholeNumbers.RoundingOff.RoundingOff().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P4WholeNumbersFactorMultiple"):
        return Problems.Primary4.WholeNumbers.FactorMultiple.FactorMultiple().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P4WholeNumbersMutliplyDivide"):
        return Problems.Primary4.WholeNumbers.MultiplicationDivision.MultiplicationDivision().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P4FractionsMixedImproper"):
        return Problems.Primary4.Fractions.MixedNumbersImproperFractions.MixedNumbersImproperFractions().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P4FractionsSimplifying"):
        return Problems.Primary4.Fractions.SimplifyingFractions.SimplifyingFractions().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P4FractionsAdd"):
        return Problems.Primary4.Fractions.AddLikeRelatedFractions.AddLikeRelatedFractions().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P4FractionsSubtract"):
        return Problems.Primary4.Fractions.SubtractLikeRelatedFractions.SubtractLikeRelatedFractions().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P4FractionsMultiplication"):
        return Problems.Primary4.Fractions.MultiplyProperImproperFractions.MultiplyProperImproperFractions().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P4DecimalsTenths"):
        return Problems.Primary4.Decimals.DecimalsTenths.DecimalsTenths().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P4DecimalsHundredths"):
        return Problems.Primary4.Decimals.DecimalsHundredths.DecimalsHundredths().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P4DecimalsThousandths"):
        return Problems.Primary4.Decimals.DecimalsThousandths.DecimalsThousandths().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P4DecimalsComparingOrdering"):
        return Problems.Primary4.Decimals.DecimalsComparingOrdering.DecimalsComparingOrdering().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P4DecimalsRoundingOff"):
        return Problems.Primary4.Decimals.DecimalsRoundingOff.DecimalsRoundingOff().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P4DecimalsFractions"):
        return Problems.Primary4.Decimals.DecimalsFractions.DecimalsFractions().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P4DecimalsAddSub"):
        return Problems.Primary4.Decimals.DecimalsAddSub.DecimalsAddSub().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P4DecimalsMultiplyDivide"):
        return Problems.Primary4.Decimals.DecimalsMultiplyDivide.DecimalsMultiplyDivide().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P4MTTime24Hrs"):
        return Problems.Primary4.Measurement.MTTime24Hrs.MTTime24Hrs().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P4MTTimeDuration"):
        return Problems.Primary4.Measurement.MTTimeDuration.MTTimeDuration().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P4MTPerimeter"):
        return Problems.Primary4.Measurement.MTPerimeter.MTPerimeter().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P4MTArea"):
        return Problems.Primary4.Measurement.MTArea.MTArea().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P4MTCompositeFigures"):
        return Problems.Primary4.Measurement.MTCompositeFigures.MTCompositeFigures().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P4DATablesBarGraphs"):
        return Problems.Primary4.DataAnalysis.P4DATablesBarGraphs.P4DATablesBarGraphs().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P4DALineGraphs"):
        return Problems.Primary4.DataAnalysis.P4DALineGraphs.P4DALineGraphs().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P4WNWordProblems"):
        return Problems.Primary4.WholeNumbers.P4WNWordProblems.P4WNWordProblems().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P4DCWordProblems"):
        return Problems.Primary4.Decimals.P4DCWordProblems.P4DCWordProblems().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P4FRWordProblems"):
        return Problems.Primary4.Fractions.P4FRWordProblems.P4FRWordProblems().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)

    elif (concept=="P3WNPlaceValues"):
        return Problems.Primary3.WholeNumbers.P3WNPlaceValue.P3WNPlaceValue().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P3WNFiguresToWords"):
        return Problems.Primary3.WholeNumbers.P3WNFiguresToWords.P3WNFiguresToWords().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P3WNWordsToFigures"):
        return Problems.Primary3.WholeNumbers.P3WNWordsToFigures.P3WNWordsToFigures().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P3WNComparingOrdering"):
        return Problems.Primary3.WholeNumbers.P3WNComparingOrdering.P3WNComparingOrdering().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P3WNNumberPatterns"):
        return Problems.Primary3.WholeNumbers.P3WNNumberPatterns.P3WNNumberPatterns().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P3WNAddition"):
        return Problems.Primary3.WholeNumbers.P3WNAddition.P3WNAddition().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P3WNSubtraction"):
        return Problems.Primary3.WholeNumbers.P3WNSubtraction.P3WNSubtraction().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P3WNMultiplication"):
        return Problems.Primary3.WholeNumbers.P3WNMultiplication.P3WNMultiplication().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P3WNDivision"):
        return Problems.Primary3.WholeNumbers.P3WNDivision.P3WNDivision().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P3WNWordProblems"):
        return Problems.Primary3.WholeNumbers.P3WNWordProblems.P3WNWordProblems().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P3MOAddition"):
        return Problems.Primary3.Money.P3MOAddition.P3MOAddition().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P3MOSubtraction"):
        return Problems.Primary3.Money.P3MOSubtraction.P3MOSubtraction().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P3MOWordProblems"):
        return Problems.Primary3.Money.P3MOWordProblems.P3MOWordProblems().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P3LMMetreCentiMetre"):
        return Problems.Primary3.LengthMassVolume.P3LMMetreCentiMetre.P3LMMetreCentiMetre().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P3LMKiloMetre"):
        return Problems.Primary3.LengthMassVolume.P3LMKiloMetre.P3LMKiloMetre().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P3LMKiloGram"):
        return Problems.Primary3.LengthMassVolume.P3LMKiloGram.P3LMKiloGram().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P3LMLitresMilli"):
        return Problems.Primary3.LengthMassVolume.P3LMLitresMilli.P3LMLitresMilli().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P3LMWordProblems"):
        return Problems.Primary3.LengthMassVolume.P3LMWordProblems.P3LMWordProblems().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P3LMWordProblems_2Steps"):
        return Problems.Primary3.LengthMassVolume.P3LMWordProblems_2Steps.P3LMWordProblems_2Steps().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P3TITellingTime"):
        return Problems.Primary3.Time.P3TITellingTime.P3TITellingTime().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P3TIConversionTime"):
        return Problems.Primary3.Time.P3TIConversionTime.P3TIConversionTime().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P3TIDuration"):
        return Problems.Primary3.Time.P3TIDuration.P3TIDuration().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P3TIAddition"):
        return Problems.Primary3.Time.P3TIAddition.P3TIAddition().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P3TISubtraction"):
        return Problems.Primary3.Time.P3TISubtraction.P3TISubtraction().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P3TIWordProblems"):
        return Problems.Primary3.Time.P3TIWordProblems.P3TIWordProblems().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P3ANIdentifying"):
        return Problems.Primary3.Angles.P3ANIdentifying.P3ANIdentifying().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P3ANRightAngle"):
        return Problems.Primary3.Angles.P3ANRightAngle.P3ANRightAngle().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P3BGBarGraphs"):
        return Problems.Primary3.BarGraphs.P3BGBarGraphs.P3BGBarGraphs().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P3APSquareUnits"):
        return Problems.Primary3.AreaPerimeter.P3APSquareUnits.P3APSquareUnits().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P3APSquareCmM"):
        return Problems.Primary3.AreaPerimeter.P3APSquareCmM.P3APSquareCmM().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P3APPerimeter"):
        return Problems.Primary3.AreaPerimeter.P3APPerimeter.P3APPerimeter().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P3APArea"):
        return Problems.Primary3.AreaPerimeter.P3APArea.P3APArea().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P3APWordProblems"):
        return Problems.Primary3.AreaPerimeter.P3APWordProblems.P3APWordProblems().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P3FRWhatIsFractions"):
        return Problems.Primary3.Fractions.P3FRWhatIsFractions.P3FRWhatIsFractions().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P3FREquivalentFractions"):
        return Problems.Primary3.Fractions.P3FREquivalentFractions.P3FREquivalentFractions().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P3FRSimplifyingFractions"):
        return Problems.Primary3.Fractions.P3FRSimplifyingFractions.P3FRSimplifyingFractions().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P3FRComparingOrdering"):
        return Problems.Primary3.Fractions.P3FRComparingOrdering.P3FRComparingOrdering().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P3FRAddition"):
        return Problems.Primary3.Fractions.P3FRAddition.P3FRAddition().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P3FRSubtraction"):
        return Problems.Primary3.Fractions.P3FRSubtraction.P3FRSubtraction().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)
    elif (concept=="P3PPPerpendicularParallel"):
        return Problems.Primary3.PerpendicularParallel.P3PPPerpendicularParallel.P3PPPerpendicularParallel().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)

    elif (concept=="P1WNAddition"):
        return Problems.Primary1.WholeNumbers.P1WNAddition.P1WNAddition().checkAnswer(template_values["template"],template_values["answer"],submitted,CheckAnswerType)

    return False              

app = Tipfy(rules=rules, config=config)    

def main():
    app.run()

if __name__ == "__main__":
    main()